!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.M=t():e.M=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var module=n[i]={exports:{},id:i,loaded:!1};return e[i].call(module.exports,module,module.exports,t),module.loaded=!0,module.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,e){var t=e(1),n=e(3),i=e(4),r=e(6),a=t.history,s=!1,o={cacheTemplate:!0,viewsSelector:"",viewClass:"",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},h=Object.keys(o),c={errorback:null,init:function(e,n){if(!s&&(e||n)){s=!0,t.isArray(e)||(n=e,e=[]),n&&t.isFunction(n.error)&&(this.error(n.error),delete n.error);var i={};t.extend(i,o,n||{}),this.routeView=new r(null,null,i),this._add(e)}},route:function(e,t,n){e=e.trim();var i=this.routeView.route(e,t,n);!i&&this.errorback&&this.errorback(e,t,n)},error:function(e){this.errorback=e},_add:function(e,n,i,r){var a;i||(i=""),t.each(e,function(e){a=e.path;var t=0;i&&("/"===i&&(i=""),a=i+a,r.parentArgsLen&&(t+=r.parentArgsLen),t+=r.keys.length,e.parentArgsLen=t),this.add(a||"/",e.callback,e,n)},this)},add:function(e,n,a,s){"object"==typeof n&&(s=a,a=n),s||(s=this.routeView);var o=s.routes;if("/"!==e.charAt(0))throw"path必须以/开头";var c=new i(e,n,a);t.Array.ensure(o,c);var u=a.children;if(u){delete a.children;var l={},d=s.options;t.each(h,function(e){e in u?l[e]=u[e]:l[e]=d[e]});var p=new r(c,s,l);routes=u.routes,delete u.routes,this._add(routes,p,e,c)}},navigate:function(e,t){"/"===e.charAt(1)&&(e=e.slice(1)),a.push(e,t)},$types:n};t.extendByBase(c),a.on("change",function(e,n,i){var r=!1;i||(r=!0);var a=t.history.parseUrl(n.url);a&&c.route(a.path,a.query,{first:r,direction:e,state:n,oldState:i})}),t.router=c,module.exports=t},function(module,exports,e){function t(e){var t=m.getPath(e);return t?n.parseQuery(t):null}var n=e(2),i=window,r={},a=[],s=function(e){return("/"+e+"/").replace(/^\/+|\/+$/g,"/")},o=n.document.getElementsByTagName("base");o=o&&o.length?s(o[0].getAttribute("href")):"/";var h=n.parseLocation().origin,c=i.history,u=(i.navigator||{}).userAgent;u||(u="");var l=parseInt((/android (\d+)/.exec(u.toLowerCase())||[])[1],10);isNaN(l)&&(l=void 0);var d=/Boxee/i.test(u),p=!(!(c&&c.pushState&&c.replaceState)||l<4||d),f=!!("onhashchange"in i),g={hashbang:1,history:2,"abstract":3},v="#!",m={mode:g.hashbang,supportPushState:p,supportHashChange:f,support:p||f,startd:!1,index:-1,preIndex:-1,base:o,checkMode:function(){this.options.hashbang?this.mode=g.hashbang:this.options.history?this.mode=g.history:this.options["abstract"]?this.mode=g["abstract"]:this.mode=g.hashbang,this.mode!==g.history||this.supportPushState||(this.mode=g.hashbang),this.support||(this.mode=g["abstract"])},start:function(e){if(!this.startd){e||(e={});var t=e.base;switch(n.isDefined(t)&&n.isString(t)&&(this.base=s(t)),this.startd=!0,this.options=n.extend({},e),this.checkMode(),this.mode){case g.history:i.addEventListener("popstate",this.onChange);break;case g.hashbang:i.addEventListener("hashchange",this.onChange);break;case g["abstract"]:}n.document.addEventListener("click",this.onDocClick),this.onChange(),this.trigger("inited")}},stop:function(){switch(this.mode){case g.history:i.removeEventListener("popstate",this.onChange);break;case g.hashbang:i.removeEventListener("hashchange",this.onChange);break;case g["abstract"]:}n.document.removeEventListener("click",this.onDocClick),this.startd=!1,this.index=-1,r={},a=[]},getPath:function(e,t){var i=n.parseUrl(e),r=decodeURIComponent(i.pathname+(t?"":i.search)),a=this.base.slice(0,-1);return r.indexOf(a)||(r=r.slice(a.length)),r=r.slice(1),(r||m.base)&&(r&&"/"===r||(r="/"+(r||""))),r},onDocClick:function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return!0;var t=e.target,i=n.getHrefAndTarget(t);t=i.target;var r=i.href;if(r&&t){var a=!t.target&&!t.hasAttribute("download")&&"external"!==t.getAttribute("rel");if(m.checkUrl(r)&&a){var s=n.getDatesetObj(t),o=m.createStateObject(r,s);return e.preventDefault(),m.pushState(o,!0),!1}}},checkUrl:function(e,t){t||(t=n.parseUrl(e).origin);var i=/^(javascript:)|(mailto:)|(tel:)/;return e&&h===t&&!i.test(e)},push:function(e,t){var n=this.createStateObject(e,t);this.pushState(n)},currentHref:function(){return n.location.href.replace(v+"/","")},pushState:function(e,t){(t||this.checkUrl(e.url,e.origin))&&e.url!==m.getCurrentState().url&&(this.mode!==g["abstract"]&&n.isUndefined(e.data.href)&&e.url!==m.currentHref()&&(this.mode===g.hashbang?n.location.hash=v+e.rpath:c[e.replace?"replaceState":"pushState"](e,e.title,e.url)),this.onChange({state:e}))},onChange:function(e){var t,i=e&&e.state||m.getUrlState(m.currentHref()),r=m.getCurrentState();if(r&&i.rurl===r.rurl)return void("popstate"!==e.type&&i.hash&&(t=n.document.getElementById(i.hash),t&&t.scrollIntoView()));var a=m.storeState(i),s="";if(a>m.index)s="forward";else{if(!(a<m.index))return e.preventDefault(),!1;s="back"}"back"!==s&&"back"===i.data.rel?s="back":"back"===s&&"back"!==i.data.rel&&"back"===r.data.rel&&(s="forward"),n.document.title=i.title,a!==m.index&&(m.preIndex=m.index),m.index=a,m.trigger(s,i,r),m.trigger("change",s,i,r)},getUrlState:function(e){return e=n.getFullUrl(e),r[e]||this.createStateObject(e)},getCurrentState:function(){var e=a[this.index];return e?r[e]||null:null},getPrevState:function(){var e=a[m.preIndex];return e||(e=a[this.index-1])?r[e]||null:null},createStateObject:function(e,t){e?"/"===e.charAt(0)&&(e=e.slice(1),e=this.base+e):e=m.currentHref();var i=n.parseUrl(e);return{data:t||(t={}),title:t.title||n.document.title,rurl:i.rurl,url:i.url,path:i.pathname,rpath:m.getPath(e),origin:i.origin,hash:i.hash,replace:n.isString(t.replace)?"true"===t.replace:!!t.replace}},hasUrl:function(e){return!!r[e]},storeState:function(e){var t=-1,i=e.rurl,s=a.indexOf(i);return this.hasUrl(i)?t=s:(t=this.index+1,a.splice(t,0,i)),r[i]=n.extend(!0,r[i],e),this.clearCache(t),t},clearCache:function(e){n.isUndefined(e)&&(e=-1);var t=e+50,i=a.slice(t);i.forEach(function(e){delete r[e]}),a.length>t&&(a.length=t)},getCache:function(){return{urlCache:a,stateCache:r}},parseUrl:t};n.extendByBase(m),n.history=m,module.exports=n},function(module,exports){function e(e){if(!("classList"in e)){e.classList={node:e};for(var t in D)e.classList[t.slice(1)]=D[t]}return e.classList}function t(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function n(e){var t;e&&(t=c.getElementById(e),t&&t.scrollIntoView())}function i(e){var t=e.split("?"),n={},i=t[0],r=t[1];if(r)for(var a,s=r.split("&"),o=s.length,h=0;h<o;h++)s[h]&&(a=s[h].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:i,query:n}}var r=window,a={},s=function(e,t,n){n||(n=null);for(var i=0,r=e.length;i<r&&!1!==t.call(n,e[i],i,e);i++);},o=function(e){return e+="",e.replace(/#.*/,"")},h=r.location,c=r.document,u=c.body,l=c.createElement("a"),d=function(e){return l.href=e,g(l)},p=function(e){return l.href=e,o(l.href)},f=function(e){e||(e=h);var t=e.hash;return"#"===t.charAt(0)&&(t=t.substr(1)),t},g=function(e){e||(e=h);var t=e.href,n=f(e),i=o(t);return n||(t=i),{url:t,rurl:i,host:e.host,hash:n,protocol:e.protocol,origin:e.origin||e.protocol+"//"+e.host,pathname:e.pathname,search:e.search,port:e.port}},v=function(e){var t="";do if(e!==u&&1===e.nodeType&&((t=e.getAttribute("data-href"))||(t=e.href)))break;while(e=e.parentElement);return{href:t||"",target:e}},m=function(e){return e.indexOf("-")<0?e:e.replace(/-[^-]/g,function(e){return e.charAt(1).toUpperCase()})},y=function(e){var t={};if(e.dataset)for(var n in e.dataset)t[n]=e.dataset[n];else for(var i,r,a=e.attributes,s=/^data-(.+)$/i,o=0,h=a.length;o<h;o++)i=a[o].name||a[o].nodeName,(r=i.match(s))&&(t[m(r[1])]=a[o].value||a[o].nodeValue);return t},w=Object.prototype,C=(w.hasOwnProperty,w.toString),b=function(e){return"[object Function]"==C.call(e)},x=function(e){return"[object Object]"===C.call(e)&&Object.getPrototypeOf(e)===w},k=a.extend=function(){var e,t,n,i,r,a,s=arguments[0]||{},o=1,h=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},o++),"object"==typeof s||b(s)||(s={}),o===h&&(s=this,o--);o<h;o++)if(null!=(e=arguments[o]))for(t in e)n=s[t],i=e[t],s!==i&&(c&&i&&(x(i)||(r=Array.isArray(i)))?(r?(r=!1,a=n&&Array.isArray(n)?n:[]):a=n&&x(n)?n:{},s[t]=k(c,a,i)):void 0!==i&&(s[t]=i));return s};a.nextTick=new function(){function e(){for(var e=i.length,t=0;t<e;t++)i[t]();i=i.slice(e)}var t=r.setImmediate,n=r.MutationObserver;if(t)return t.bind(r);var i=[];if(n){var a=c.createTextNode("M");return new n(e).observe(a,{characterData:!0}),function(e){i.push(e),a.data=Math.random()}}return function(e){setTimeout(e)}};var S={_eventData:null,on:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]||(this._eventData[e]=[]);var n=!1;s(this._eventData[e],function(e){if(e===t)return n=!0,!1}),n||this._eventData[e].push(t)},off:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]&&this._eventData[e].length&&(t?s(this._eventData[e],function(n,i){if(n===t)return this._eventData[e].splice(i,1),!1}):this._eventData[e]=[])},trigger:function(e){if(this._eventData||(this._eventData={}),this._eventData[e]){var t=this._eventData[e].slice.call(arguments,1);s(this._eventData[e],function(e){e.apply(null,t)})}}},A=function(){},E="m-"+(new Date).getTime()+"-",T=1,_={},V=function(e){var t="";return e&&(t=_[e])||(t=E+T++,e&&(_[e]=t)),t},I=/[^, ]+/g,L=/^\[object SVG\w*Element\]$/,D={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;L.test(t)?t.setAttribute("class",e):t.className=e}};"add,remove".replace(I,function(t){a[t+"Class"]=function(n,i){return i&&"string"==typeof i&&n&&1===n.nodeType&&i.replace(/\S+/g,function(i){e(n)[t](i)}),this}}),"undefined"!=typeof $&&b($.prototype.html)?a.innerHTML=function(e,t){$(e).html(t)}:a.innerHTML=function(e,t){e.innerHTML=t},a.extend({rword:I,noop:A,each:s,trimUrl:o,parseUrl:d,getHash:f,getFullUrl:p,getHrefAndTarget:v,camelize:m,getDatesetObj:y,isFunction:b,isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:x,parseLocation:g,getUIDByKey:V,hasClass:function(t,n){return 1===t.nodeType&&e(t).contains(n)},removeEle:t,scrollToHash:n,parseQuery:i,location:h,document:c,body:u,html:c.documentElement,Base:S,extendByBase:function(e){return k(e,S)},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},indexOfByKey:function(e,t,n){for(var i=t[n],r=0,a=e.length;r<a;r++)if(e[r][n]===i)return r;return-1}}}),module.exports=a},function(module,exports){module.exports={date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(e){return 0!==parseInt(e,10)}},"int":{pattern:"\\d+",decode:function(e){return parseInt(e,10)}}}},function(module,exports,e){function t(e,t,i){i=i||{},i.callback=t||r.noop,e.length>2&&"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1),i.last="/"),i=n(e,i),delete i.path,delete i.last,this.routeView=null,this.instances=[],this.path=e,this.activeIndex=-1,r.each(["cacheTemplate","animation","aniClass","redirectTo","redirectPushState","callback","getTemplate","onActive","onDestroy","onEnter","onLeave","regexp","$regexp","keys","parentArgsLen"],function(e){this[e]=i[e],delete i[e]},this);var a=this.redirectTo;r.isString(a)&&(this.redirectTo=function(){return a}),this.redirectTo&&r.isUndefined(this.redirectPushState)&&(this.redirectPushState=!0),this.parentArgsLen||(this.parentArgsLen=0),this.options=i}function n(e,t){for(var n,r,s,h,c=t.keys=[],u="boolean"!=typeof t.caseInsensitive||t.caseInsensitive,l="^",d=0;n=o.exec(e);){r=n[2]||n[3],s=n[4]||("*"==n[1]?".*":"string"),h=e.substring(d,n.index);var p=a[s],f={name:r};p&&(s=p.pattern,f.decode=p.decode),c.push(f),l+=i(h,s,!1),d=o.lastIndex}return h=e.substring(d),l+=i(h),t.children&&(t.$regexp=new RegExp(l,u?"i":void 0)),l+=(t.strict?t.last:"/?")+"$",t.regexp=new RegExp(l,u?"i":void 0),t}function i(e,t,n){var i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;var r=n?"?":"";return i+r+"("+t+")"+r}var r=e(2),a=e(3),s=e(5),o=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g;r.extend(t.prototype,{ins:function(e,t,n,i){var a=this,o=null;return r.each(a.instances,function(r,s){if(a.checkEqual(r,e,t))return o=r,a.setActive(s),o.setOptions(i),o.setArgs(n),!1}),o?o:(o=new s(this,e,t,n,i),this.instances.push(o),this.setActive(this.instances.length-1),o)},checkEqual:function(e,t,n){return e.path===t},getIns:function(e){return this.instances[e]},getActive:function(){return this.getIns(this.activeIndex)},setActive:function(e){this.activeIndex=e},setRouteView:function(e){this.routeView=e},ele:function(){var e=this.getActive()||null;return e&&e.element},destroyIns:function(e){if(e){return this.getActive()===e?(this.instances.splice(this.activeIndex,1),this.setActive(-1),void e.destroy()):void r.each(this.instances,function(t,n){if(t===e)return this.instances.splice(n,1),this.activeIndex>n&&this.setActive(this.activeIndex-1),e.destroy(),!1},this)}}}),module.exports=t},function(module,exports,e){function t(e,t,n,i,r){this.route=e,this.path=t,this.query=n,this.options=r,this.params={},this.args=null,this.element=null,this.cached=!1,this._oldTemplate="",this.destroyed=!1,this.setArgs(i)}function n(e,t,n){for(var i=0,r=t.length;i<r;i++){var a=t[i],s=e[i]||"";if("function"==typeof a.decode)var o=a.decode(s);else try{o=JSON.parse(s)}catch(h){o=s}e[i]=n.params[a.name]=o}n.args=e}function i(e){var t=e.args;if(!t)return void(e.args=[]);if(e.route.keys.length){var n=e.route.parentArgsLen;t.splice(0,n)}else t.length=0}var r=e(1);r.extend(t.prototype,{setArgs:function(e){this.route.keys.length?(n(e,this.route.keys,this),i(this)):this.args=[]},setOptions:function(e){this.destroyed||(this.options=e)},setEle:function(e){this.element=e},equalTo:function(e,t){var n=r.history.parseUrl(e);return!(!n||!this.route.checkEqual(this,n.path,n.query))&&(t&&(this.query=n.query),!0)},isParentOf:function(e){var t=this.route.$regexp;if(t){var n=e.match(t);if(n&&n[0]===this.path)return!0}return!1},destroy:function(){this.destroyed||(this.route=null,this.path="",this.query=null,this.options=null,this.params=null,this.args=null,this.element&&r.removeEle(this.element),this.element=null,this.destroyed=!0)}}),module.exports=t},function(module,exports,e){function t(e,t,n){e?(e.setRouteView(this),this.$parentRoute=e):this.$parentRoute=null,t&&(this.$parent=t),this.routes=[],this.maskEle=null,this.pageViewState=null,this.viewsContainer=null,this.routeIns=null,this.options=n,this.pagesCache=[],this.templateCache={},this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),e||this.setViewsContainer(i.document.body)}function n(e,t){var n=e.route[t];return i.isFunction(n)&&n.apply(e,e.args)}var i=e(2),r=i.document.createElement("div"),a=function(){for(var e,t=r.style,n=["a","webkitA","MozA","OA","msA"],i=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],a=0,s=n.length;a<s;a++)if(e=n[a]+"nimation",e in t)return i[a];return"animationend"}(),s="page-view",o="in";i.extend(t.prototype,{route:function(e,t,n,r,a){var s=this.routes;n||(n={});for(var o,h,c,u=!1,l=this,d=0;o=s[d];d++){var p=e.match(r&&o.$regexp||o.regexp);if(p){h=p.shift(),c=o.ins(h,t||{},p,n);for(var f,g,v=l;v&&(f=v.$parentRoute);){if(g=f.getActive(),!l.viewsContainer||!g||!g.isParentOf(c.path))return l.$parent.route(c.path,c.query,i.extend({matchIns:c},n),e,function(){delete l.$parent.pageViewState.options.matchIns,l.pageViewState&&l.pageViewState.path===e||(l._waiting=!0,l._route(c,a))}),!0;v=v.$parent}l._route(c,a),u=!0}else r||o.routeView&&(u=o.routeView.route(e,t,n));if(u)break}return u},_redirectTo:function(e,t){function r(){!e.element&&s.destroyIns(e);var n={};t||(n.redirectToSync=!0),s.redirectPushState||(n.href=a),i.router.navigate(a,n)}var a,s=e.route;return!(!s.redirectTo||!(a=n(e,"redirectTo"))||e.equalTo(a,!0))&&(t?i.nextTick(r):r(),!0)},_getDefaultEle:function(e){var t,n=i.getUIDByKey(e.path);return!e.options.first||!(t=this.viewsContainer.getElementsByClassName(s)[0])||t.id&&t.id!==n?null:t},_checkInsActive:function(e){return this.routeIns===e},_route:function(e,t){function r(n){o.getTemplateCb(e,n,t)}this.routeIns&&this.routeIns.endCall&&this.routeIns.endCall(),this.routeIns=e;var a=e.route,o=this,h=this.getOption(a,e.options.state,"cacheTemplate"),c=(i.getUIDByKey(e.path),this._getDefaultEle(e));if(c){var u=c.getElementsByClassName(s),l=[];i.each(u,function(e){e.parentNode==c&&(i.removeEle(e),l.push(e))}),this.templateCache[e.path]=c.innerHTML,h=!0,i.each(l,function(e){c.appendChild(e)}),u=null,l=null}i.isString(h)&&(h="true"===h),e.options.first=e.options.first||!this.pageViewState;var d=e.args;if(h&&this.templateCache[e.path]||!a.getTemplate){if(!a.getTemplate&&!t&&this._redirectTo(e,!0))return;n(e,"onActive"),i.router.trigger("routeChangeStart",e,d),r(this.templateCache[e.path])}else n(e,"onActive"),i.router.trigger("routeChangeStart",e,d),this.showLoading(),a.getTemplate.length>0?(this._waiting=!1,a.getTemplate.call(e,r)):r(a.getTemplate.call(e))},setViewsContainer:function(e){var t,n;e&&(n=this.options.viewsSelector,t=n&&e.querySelector(n)),this.viewsContainer=t||e||null},showLoading:function(e){(this.options.showLoading||e)&&(this.maskEle||this.initMaskEle(),this.maskEle.style.visibility="visible")},initMaskEle:function(){this.maskEle=r.cloneNode(),this.maskEle.className=this.options.maskClass,this.maskEle.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>',this.viewsContainer.appendChild(this.maskEle)},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},getOption:function(e,t,n){if((e||t)&&n){var r;return t&&(r=t.data[n]),i.isUndefined(r)&&(r=e[n],i.isUndefined(r)&&(r=this.options[n])),r}},getTemplateCb:function(e,t,r){function a(){var t=i.Array.indexOfByKey(l.pagesCache,e,"path");~t&&l.pagesCache.splice(t,1),l.pagesCache.push(e),h(),c()}function s(){return e.endCall===i.noop||e.destroyed?void(e.endCall=i.noop):(h(),n(e,"onEnter"),c(),void(e.endCall=i.noop))}function h(){g&&y&&(!y.defaultTemplate&&e.cached||(i.innerHTML(f,t),e.cached=!1))}function c(){y&&y.setViewsContainer(e.element),n(e,"callback"),i.router.trigger("routeChangeEnd",e,e.args),r&&r(),delete l._waiting,!m&&!r&&l._redirectTo(e)}if(this.hideLoading(),this._checkInsActive(e)){e._oldTemplate=this.templateCache[e.path],this.templateCache[e.path]=t||"";var u,l=this,d=e.options,p=i.getUIDByKey(e.path);d.first&&(u=this._getDefaultEle(e),i.removeEle(this.maskEle),this.viewsContainer&&this.$parentRoute&&this.viewsContainer!==this.$parentRoute.ele()&&(this.defaultTemplate=this.viewsContainer.innerHTML,u||(i.innerHTML(this.viewsContainer,""),this.maskEle=null)),this.maskEle&&this.viewsContainer.appendChild(this.maskEle));var f=i.document.getElementById(p);f?e.cached=!0:(f=u||i.document.createElement("div"),f.id=p,e.cached=!1,!u&&this.viewsContainer.appendChild(f));var g=i.hasClass(f,o),v=e.route,m=!1;if(g&&e.element===f&&l._redirectTo(e,!0))return m=!0,void s();(e.cached||u)&&t===e._oldTemplate||(g||i.innerHTML(f,t),e.cached=!1);var y=v.routeView;if(y){var w=y.pageViewState;if(g)return void(w&&w!==e.options.matchIns?y._transView(null,w,d,s):s());if(w){var C,b=e.options.matchIns,x=!1;if(b){C=b.route;for(var k,S=y;!x&&S&&S.pageViewState;)k=S.pageViewState.route.routeView,C==S.pageViewState.route?(x=!0,b.path!==S.pageViewState.path&&S._transView(null,S.pageViewState,d),k&&k.pageViewState&&k._transView(null,k.pageViewState,d)):S=k}x||y._transView(null,w,d)}}this._transView(f,e,d,a)}},_transView:function(e,t,r,h){function c(e,t){setTimeout(function(){t&&e.removeEventListener(a,t)})}function u(){return e?void l():(t.endCall(),l(),b.pageViewState=null,void(b.defaultTemplate&&i.innerHTML(b.viewsContainer,b.defaultTemplate)))}function l(){setTimeout(function(){i.removeClass(b.viewsContainer,y)},100),A&&E&&b.checkPageViews()}var d=o,p="out",f=p,g="reverse",v="ani",m=d+" "+g,y="overhidden",w=this.pageViewState,C=w&&w.element,b=this;this.pageViewState=t,e&&(i.removeClass(e,m),i.addClass(e,s+" "+this.options.viewClass)),t.endCall=function(){return t.endCall===i.noop||t.destroyed?void(t.endCall=i.noop):(h&&h.apply(this,arguments),void(t.endCall=i.noop))},t.setEle(e);var x=this._shouldAni(this.options.animation,t,r);if(x=x&&!!h&&!t.redirectTo&&!t.options.state.data.redirectToSync){var k=v,S=v;k+=" "+this.getOption(t.route,r.state,"aniClass"),r.first||(S+=" "+this.getOption(w.route,r.oldState,"aniClass")),d=k+" "+d,p=S+" "+p,i.addClass(this.viewsContainer,y)}"back"===r.direction&&(d+=" "+g,p+=" "+g),C&&(i.removeClass(C,m),i.addClass(C,p),C.offsetWidth=C.offsetWidth,n(w,"onLeave"),w.route.getActive()===w&&w.route.setActive(-1)),e&&(i.removeClass(e,f),i.addClass(e,d),e.offsetWidth=e.offsetWidth,n(t,"onEnter")),!t.cached&&r.state.hash&&i.scrollToHash(r.state.hash);var A=!1,E=!1;return x?(e&&e.addEventListener(a,function T(){A=!0,c(e,T),i.removeClass(e,k),t.endCall(),l()}),void(C&&C.addEventListener(a,function _(){E=!0,c(C,_),i.removeClass(C,S),u()}))):(A=!0,E=!0,t.endCall(),void u())},_shouldAni:function(e,t,n){var i=this.getOption(t.route,n.state,"animation"),r=e;return n.first||(r=this.getOption(this.pageViewState.route,n.oldState,"animation")),i=1==i||"true"==i,r=1==r||"true"==r,e=i&&r&&(!this._waiting||!n.first),n.first&&(e=e&&!!this.$parentRoute),e},checkPageViews:function(){var e=this.options.cacheViewsNum,t=this.pagesCache;if(!(t.length<=e)){var n=i.Array.indexOfByKey(t,this.pageViewState,"path"),r=0,a=0;for(r=n-Math.floor((e-1)/2),r<0&&(r=0),a=e-1+r,a>t.length-1&&(r-=a-t.length+1,a=t.length-1);r>0;)this.destroyRouteIns(t.shift()),r--,a--;for(;a<t.length-1;)this.destroyRouteIns(t.pop())}},destroyRouteIns:function(e){if(!e.destroyed){var t=e.route,r=t.routeView,a=this.pageViewState&&this.pageViewState.route;if(r&&(!r.pageViewState||t!==a)){for(var s=r.pagesCache.shift();s;)r.destroyRouteIns(s),s=r.pagesCache.shift();r.pageViewState=null,a&&t.ele()==this.pageViewState.element||r.setViewsContainer(null),i.removeEle(r.maskEle),r.maskEle=null}n(e,"onDestroy"),t.destroyIns(e),e=null}},getTemplateCache:function(){return this.templateCache}}),module.exports=t}])});