!function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m",function(exports){return t(e,exports)}):e.M=t(e,{})}(this,function(e,t){function n(e){if(!("classList"in e)){e.classList={node:e};for(var t in x)e.classList[t.slice(1)]=x[t]}return e.classList}var i=function(e,t,n){n||(n=null);for(var i=0,r=e.length;r>i&&!1!==t.call(n,e[i],i,e);i++);},r=function(e){return e+="",e.replace(/#.*/,"")},a=e.location,o=e.document,s=o.body,c=o.createElement("a"),l=function(e){return c.href=e,f(c)},u=function(e){return c.href=e,r(c.href)},h=function(e){e||(e=a);var t=e.hash;return"#"===t.charAt(0)&&(t=t.substr(1)),t},f=function(e){return e||(e=a),{url:e.href,rurl:r(e.href),host:e.host,hash:h(e),protocol:e.protocol,origin:e.origin||e.protocol+"//"+e.host,pathname:e.pathname,search:e.search,port:e.port}},d=function(e){var t="";do if(e!==s&&1===e.nodeType&&((t=e.getAttribute("data-href"))||(t=e.href)))break;while(e=e.parentElement);return{href:t||"",target:e}},p=function(e){return e.indexOf("-")<0?e:e.replace(/-[^-]/g,function(e){return e.charAt(1).toUpperCase()})},g=function(e){var t={};if(e.dataset)for(var n in e.dataset)t[n]=e.dataset[n];else for(var i,r,a=e.attributes,o=/^data-(.+)$/i,s=0,c=a.length;c>s;s++)i=a[s].name||a[s].nodeName,(r=i.match(o))&&(t[p(r[1])]=a[s].value||a[s].nodeValue);return t},m=Object.prototype,v=(m.hasOwnProperty,m.toString),y=function(e){return"[object Function]"==v.call(e)},w=function(e){return"[object Object]"===v.call(e)&&Object.getPrototypeOf(e)===m},b=t.extend=function(){var e,t,n,i,r,a,o=arguments[0]||{},s=1,c=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[1]||{},s++),"object"==typeof o||y(o)||(o={}),s===c&&(o=this,s--);c>s;s++)if(null!=(e=arguments[s]))for(t in e)n=o[t],i=e[t],o!==i&&(l&&i&&(w(i)||(r=Array.isArray(i)))?(r?(r=!1,a=n&&Array.isArray(n)?n:[]):a=n&&w(n)?n:{},o[t]=b(l,a,i)):void 0!==i&&(o[t]=i));return o},C={_eventData:null,on:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]||(this._eventData[e]=[]);var n=!1;i(this._eventData[e],function(e){return e===t?(n=!0,!1):void 0}),n||this._eventData[e].push(t)},off:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]&&this._eventData[e].length&&(t?i(this._eventData[e],function(n,i){return n===t?(this._eventData[e].splice(i,1),!1):void 0}):this._eventData[e]=[])},trigger:function(e){if(this._eventData||(this._eventData={}),this._eventData[e]){var t=this._eventData[e].slice.call(arguments,1);i(this._eventData[e],function(e){e.apply(null,t)})}}},_=function(){},k="m-"+(new Date).getTime()+"-",S=1,E={},V=function(e){var t="";return e&&(t=E[e])||(t=k+S++,e&&(E[e]=t)),t},O=/[^, ]+/g,x={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;rsvg.test(t)?t.setAttribute("class",e):t.className=e}};return"add,remove".replace(O,function(e){t[e+"Class"]=function(t,i){return i&&"string"==typeof i&&t&&1===t.nodeType&&i.replace(/\S+/g,function(i){n(t)[e](i)}),this}}),t.innerHTML="undefined"!=typeof $&&y($.prototype.html)?function(e,t){$(e).html(t)}:function(){function e(e){"string"!=typeof e&&(e+=""),e=e.replace(a,"<$1></$2>").trim();var t,o=(r.exec(e)||["",""])[1].toLowerCase(),u=n[o]||n._default,h=l.cloneNode(!1);u.innerHTML=e;{var f=u.getElementsByTagName("script");[].forEach}if(f.length)for(var d,p,g=0;d=f[g++];)s[d.type]&&(p=c.cloneNode(!1),i(d.attributes,function(e){p.setAttribute(e.name,e.value)}),p.text=d.text,d.parentNode.replaceChild(p,d));for(;t=u.firstChild;)h.appendChild(t);return h}var n=new function(){t.extend(this,{option:o.createElement("select"),thead:o.createElement("table"),td:o.createElement("tr"),area:o.createElement("map"),tr:o.createElement("tbody"),col:o.createElement("colgroup"),legend:o.createElement("fieldset"),_default:o.createElement("div"),g:o.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};"circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use".replace(O,function(e){n[e]=n.g});var r=/<([\w:]+)/,a=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,s={"":1,"text/javascript":1,"text/ecmascript":1,"application/ecmascript":1,"application/javascript":1},c=o.createElement("script"),l=o.createDocumentFragment();return function(t,n){var i=e(n);t.innerHTML="",t.appendChild(i),i=null}}(),t.extend({rword:O,noop:_,each:i,trimUrl:r,parseUrl:l,getHash:h,getFullUrl:u,getHrefAndTarget:d,camelize:p,getDatesetObj:g,isFunction:y,isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:w,parseLocation:f,getUIDByKey:V,hasClass:function(e,t){return 1===e.nodeType&&n(e).contains(t)},location:a,document:o,body:s,html:o.documentElement,Base:C,extendByBase:function(e){return b(e,C)},Array:{ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,n){var i=e.indexOf(n);return~i?t.Array.removeAt(e,i):!1},indexOfByKey:function(e,t,n){for(var i=t[n],r=0,a=e.length;a>r;r++)if(e[r][n]===i)return r;return-1}},Object:{create:Object.create||function(e){return{__proto__:e}},setPrototypeOf:Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},getPrototypeOf:Object.getPrototypeOf||function(e){return e.__proto__},keys:Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}}}),t}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.history",function(require){var n=require("m");return n.history=t(e,n),n}):M.history=t(e,e.M)}(this,function(e,t){var n={},i=[],r=function(e){return("/"+e+"/").replace(/^\/+|\/+$/g,"/")},a=t.document.getElementsByTagName("base");a=a&&a.length?r(a[0].getAttribute("href")):"/";var o=t.parseLocation().origin,s=e.history,c=(e.navigator||{}).userAgent;c||(c="");var l=parseInt((/android (\d+)/.exec(c.toLowerCase())||[])[1],10);isNaN(l)&&(l=void 0);var u=/Boxee/i.test(c),h=!(!(s&&s.pushState&&s.replaceState)||4>l||u),f={support:h,_startd:!1,index:-1,base:a,start:function(n){if(!this._startd){n||(n={});var i=n.base;t.isDefined(i)&&t.isString(i)&&(this.base=r(i)),this._startd=!0,this.options=t.extend({enablePushState:!0},n),h&&(this.options.enablePushState&&e.addEventListener("popstate",this.onChange),t.document.addEventListener("click",this.onDocClick)),this.onChange({type:"popstate",state:f.getUrlState(t.location.href)}),this.trigger("inited")}},stop:function(){h&&(this.options.enablePushState&&e.removeEventListener("popstate",this.onChange),t.document.removeEventListener("click",this.onDocClick)),this._startd=!1,this.index=-1,n={},i=[]},getPath:function(e){var n=t.parseUrl(e),i=decodeURIComponent(n.pathname+n.search),r=this.base.slice(0,-1);return i.indexOf(r)||(i=i.slice(r.length)),i.slice(1)},onDocClick:function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return!0;var n=e.target,i=t.getHrefAndTarget(n);n=i.target;var r=i.href;if(f.checkUrl(r)&&!n.target){var a=t.getDatesetObj(n),o=f.createStateObject(r,a);return e.preventDefault(),f.pushState(o,!0),!1}},checkUrl:function(e,n){n||(n=t.parseUrl(e).origin);var i=/^javascript:/;return e&&o===n&&!i.test(e)},push:function(e,t){var n=this.createStateObject(e,t);this.pushState(n)},pushState:function(e,n){(n||this.checkUrl(e.url,e.origin))&&e.url!==f.getCurrentState().url&&(this.options.enablePushState&&t.isUndefined(e.data.href)&&e.url!==t.location.href&&s["true"==e.replace?"replaceState":"pushState"](e,e.title,e.url),this.onChange({state:e}))},onChange:function(e){var n,i=e&&e.state||f.getUrlState(t.location.href),r=f.getCurrentState();if(r&&i.rurl===r.rurl)return void("popstate"!==e.type&&i.hash&&(n=t.document.getElementById(i.hash),n&&n.scrollIntoView()));var a=f.storeState(i),o="";if(a>f.index)o="forward";else{if(!(a<f.index))return e.preventDefault(),!1;o="back"}"back"!==o&&"back"===i.data.rel?o="back":"back"===o&&"back"!==i.data.rel&&"back"===r.data.rel&&(o="forward"),t.document.title=i.title,f.index=a,f.trigger(o,i,r),f.trigger("change",o,i,r)},getUrlState:function(e){return e=t.getFullUrl(e),n[e]||this.createStateObject(e)},getCurrentState:function(){var e=i[this.index];return e?n[e]||null:null},getPrevState:function(){var e=i[this.index-1];return e?n[e]||null:null},createStateObject:function(e,n,i){e?"/"===e.charAt(0)&&(e=e.slice(1),e=this.base+e):e=t.location.href;var r=t.parseUrl(e);return{data:n||(n={}),title:i||n.title||t.document.title,rurl:r.rurl,url:r.url,origin:r.origin,hash:r.hash}},hasUrl:function(e){return!!n[e]},storeState:function(e){var r=-1,a=e.rurl;return this.hasUrl(a)?r=i.indexOf(a):(i.push(a),r=i.length-1),n[a]=t.extend(!0,n[a],e),this.clearCache(r),r},clearCache:function(e){t.isUndefined(e)&&(e=-1);var r=i.slice(e+1);r.forEach(function(e){delete n[e]}),i.length=e+1},getCache:function(){return{urlCache:i,stateCache:n}}};return t.extendByBase(f),f}),function(e,t){"function"==typeof define&&(define.amd||define.cmd)?define("m.router",function(require){var n=require("m.history");return n.router=t(e,n,n.history),n}):M.router=t(e,M,M.history)}(this,function(e,t,n){function i(e,t){e?e.$routeView=this:this.$root=!0,this.routes=[],this.maskEle=null,this.pageViewState=null,this.viewsContainer=null,this.options=t,this.pagesCache=[],this.templateCache={},this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),e||this.setViewsContainer()}function r(e,t,n){var i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;var r=n?"?":"";return i+r+"("+t+")"+r}function a(e,t){for(var n=t.keys,i=0,r=n.length;r>i;i++){var a=n[i],o=e[i]||"";if("function"==typeof a.decode)var s=a.decode(o);else try{s=JSON.parse(o)}catch(c){s=o}e[i]=t.params[a.name]=s}}var o=function(e){var t=e.split("?"),n={},i=t[0],r=t[1];if(r)for(var a,o=r.split("&"),s=o.length,c=0;s>c;c++)o[c]&&(a=o[c].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:i,query:n}},s=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,c=!1,l="page-view",u={cacheTemplate:!0,viewsSelector:"",viewClass:"",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},h=t.Object.keys(u),f=t.document.createElement("div"),d=function(){for(var e,t=f.style,n=["a","webkitA","MozA","OA","msA"],i=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],r=0,a=n.length;a>r;r++)if(e=n[r]+"nimation",e in t)return i[r];return"animationend"}();t.extend(i.prototype,{route:function(e,n,i){function r(e){u.getTemplateCb(s,e,f)}var o=this.routes;i||(i={});for(var s,c=!1,u=this,h=0;s=o[h];h++){var f=e.match(s.regexp);if(f){if(s.element){for(var d=!1;s;){if(s.path===e){d=!0;break}if(!s.$child)break;s=s.$child}if(!d){var g=s;s=t.Object.create(g),["cacheTemplate","callback","getTemplate","keys","onDestroy","pattern","regexp","$routeView"].forEach(function(e){s[e]=g[e]}),s.$child=null,g.$child=s,o[h]=s}}s.query=n||{},s.path=e,s.params={},s.historyOptions=i;var m=s.keys;f.shift(),m.length&&a(f,s);var v=u.getOption(s,i.state,"cacheTemplate");if(i.first){var y=u.viewsContainer.getElementsByClassName(l)[0];y&&(u.templateCache[s.path]=y.innerHTML,v=!0)}t.isString(v)&&(v="true"===v),v&&u.templateCache[s.path]||!s.getTemplate?(p.trigger("routeChangeStart",s,f),r(u.templateCache[s.path])):(p.trigger("routeChangeStart",s,f),u.showLoading(),s.getTemplate.length?s.getTemplate(r):r(s.getTemplate())),c=!0}else s.$routeView&&(c=s.$routeView.route(e,n,i));if(c)break}return c},setViewsContainer:function(e){var n=this.options.viewsSelector,i=e||t.document,r=n&&i.querySelector(n);r||(r=e||i.body),this.viewsContainer=r},animate:function(e){this.options.animation=!!e},showLoading:function(e){(this.options.showLoading||e)&&(this.maskEle||this.initMaskEle(),this.maskEle.style.visibility="visible")},initMaskEle:function(){this.maskEle=f.cloneNode(),this.maskEle.className=this.options.maskClass,this.maskEle.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>',this.viewsContainer.appendChild(this.maskEle)},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},getOption:function(e,n,i){if(!e&&!n)return void 0;if(!i)return void 0;var r;return n&&(r=n.data[i]),t.isUndefined(r)&&(r=e[i],t.isUndefined(r)&&(r=this.options[i])),r},getTemplateCb:function(e,n,i){function r(n){e.element=n;var i=t.Array.indexOfByKey(s.pagesCache,e,"path");~i&&s.pagesCache.splice(i,1),s.pagesCache.push(e),s.pageViewState=e,a()}function a(){e.callback.apply(e,i),p.trigger("routeChangeEnd",e,i),e.$routeView&&e.$routeView.setViewsContainer(e.element)}this.hideLoading(),e._oldTemplate=this.templateCache[e.path],this.templateCache[e.path]=n;var o,s=this,c=e.historyOptions,u=c.first||!this.pageViewState,h=t.getUIDByKey(e.path);u&&(c.first=u,o=this.viewsContainer.getElementsByClassName(l)[0]);var f="in",d=t.document.getElementById(h);if(d?e.cached=!0:(d=o||t.document.createElement("div"),d.id=h,e.cached=!1,!o&&this.viewsContainer.appendChild(d)),(!e.cached&&!o||n!==e._oldTemplate)&&(t.innerHTML(d,n),e.cached=!1),e.$routeView){var g=t.hasClass(d,f);if(g)return void e.$routeView._transView(null,e.$routeView.pageViewState,c,a);e.$routeView.pageViewState&&e.$routeView._transView(null,e.$routeView.pageViewState,c)}this._transView(d,e,c,r)},_transView:function(e,n,i,r){function a(){C&&_&&g.checkPageViews()}var o="in",s="out",c=s,u="reverse",h="ani",f=o+" "+u,p=this.pageViewState,g=this;e&&(t.removeClass(e,f),t.addClass(e,l+" "+this.options.viewClass));var m=this._shouldAni(this.options.animation,n,i);if(m=m&&!!r){var v=h,y=h;v+=" "+this.getOption(n,i.state,"aniClass"),i.first||(y+=" "+this.getOption(p,i.oldState,"aniClass")),o=v+" "+o,s=y+" "+s}if("back"===i.direction&&(o+=" "+u,s+=" "+u),p&&(t.removeClass(p.element,f),t.addClass(p.element,s),p.element.offsetWidth=p.element.offsetWidth),e&&(t.removeClass(e,c),t.addClass(e,o),e.offsetWidth=e.offsetWidth),!n.cached){var w,b=i.state.hash;b&&(w=t.document.getElementById(b),w&&w.scrollIntoView())}var C=!1,_=!1;return m?(e&&e.addEventListener(d,function k(){C=!0,e.removeEventListener(d,k),t.removeClass(e,v),r&&r(e),a(),k=null,e=null}),void(p&&p.element.addEventListener(d,function S(){_=!0,p.element.removeEventListener(d,S),t.removeClass(p.element,y),e||(r&&r(),g.pageViewState=null),a(),S=null,p=null}))):(C=!0,_=!0,r&&r(e),void a())},_shouldAni:function(e,t,n){var i=this.getOption(t,n.state,"animation"),r=e;return n.first||(r=this.getOption(this.pageViewState,n.oldState,"animation")),i=1==i||"true"==i?!0:!1,r=1==r||"true"==r?!0:!1,e=i&&r&&(!this.$root||!n.first)},checkPageViews:function(){var e=this.options.cacheViewsNum,n=this.pagesCache;if(!(n.length<=e)){var i=t.Array.indexOfByKey(n,this.pageViewState,"path"),r=0,a=0;for(r=i-Math.floor((e-1)/2),0>r&&(r=0),a=e-1+r,a>n.length-1&&(r-=a-n.length+1,a=n.length-1);r>0;)this.destroyState(n.shift()),r--,a--;for(;a<n.length-1;)this.destroyState(n.pop())}},destroyState:function(e){if(e.$routeView){for(var n=e.$routeView.pagesCache.pop();n;)e.$routeView.destroyState(n),n=e.$routeView.pagesCache.pop();e.$routeView.viewsContainer=null,e.$routeView.pageViewState=null;var i=e.$routeView.maskEle;i&&i.parentNode.removeChild(i),e.$routeView.maskEle=null}t.isFunction(e.onDestroy)&&e.onDestroy();try{e.element&&e.element.parentNode.removeChild(e.element)}catch(r){}e.element=null;var a=t.Object.getPrototypeOf(e);a&&a.$child&&(a.$child=e.$child||null),e.$child&&(t.Object.setPrototypeOf(e.$child,a||null),e.$child=null),t.Object.setPrototypeOf(e,null),e=null},getTemplateCache:function(){return this.templateCache}});var p={options:u,errorback:null,init:function(e,n){c||!e&&!n||(c=!0,t.isArray(e)||(n=e,e=[]),n&&t.isFunction(n.error)&&(this.error(n.error),delete n.error),t.extend(this.options,n||{}),this.$routeView=new i(null,this.options),this._add(e))},route:function(e,t,n){e=e.trim();var i=this.$routeView.route(e,t,n);!i&&this.errorback&&this.errorback(e,t,n)},error:function(e){this.errorback=e},_add:function(e,n,i){var r;i||(i=""),t.each(e,function(e){r=i+e.path,e.pattern=r,delete e.path,this.add(r||"/",e.callback,e,n)},this)},add:function(e,n,r,a){"object"==typeof n&&(a=r,r=n),a||(a=this.$routeView);var o=a.routes;if("/"!==e.charAt(0))throw"path必须以/开头";r=r||{},r.callback=n||t.noop,e.length>2&&"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1),r.last="/"),t.Array.ensure(o,this._pathToRegExp(e,r));var s=r.children;if(s){var c={},l=this.options;t.each(h,function(e){c[e]=e in s?s[e]:l[e]});var u=new i(r,c);routes=s.routes,delete s.routes,this._add(routes,u,e),delete r.children}},_pathToRegExp:function(e,t){for(var n,i,a,o,c=t.keys=[],l="boolean"==typeof t.caseInsensitive?t.caseInsensitive:!0,u="^",h=0;n=s.exec(e);){i=n[2]||n[3],a=n[4]||("*"==n[1]?".*":"string"),o=e.substring(h,n.index);var f=this.$types[a],d={name:i};f&&(a=f.pattern,d.decode=f.decode),c.push(d),u+=r(o,a,!1),h=s.lastIndex}return o=e.substring(h),u+=r(o)+(t.strict?t.last:"/?")+"$",t.regexp=new RegExp(u,l?"i":void 0),t},navigate:function(e,t){"/"===e.charAt(1)&&(e=e.slice(1)),n.push(e,t)},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(e){return 0===parseInt(e,10)?!1:!0}},"int":{pattern:"\\d+",decode:function(e){return parseInt(e,10)}}}};return t.extendByBase(p),n.on("change",function(e,t,i){var r=!1;i||(r=!0);var a=t.url,s=n.getPath(a);if(s||n.base||r){s&&"/"===s||(s="/"+(s||""));var c=o(s);p.route(c.path,c.query,{first:r,direction:e,state:t,oldState:i})}}),p});